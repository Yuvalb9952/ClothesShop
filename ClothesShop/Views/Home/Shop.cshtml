@{ 
    ViewData["Title"] = "Shop";
    List<Product> products = ViewBag.Products;
    List<Category> categories = ViewBag.categories;
    int productsInBagCount = ViewBag.productsInBagCount; 
}
<div class="container view-container">
    <div class="layout">
        <section class="inner">

            Items in your cart: @productsInBagCount.ToString()

            <div id="search" class="horizontal">
                <form id="searchForm" class="horizontal" asp-action="Shop" asp-controller="Home" method="POST">
                    <input id="searchText" name="searchText" type="search" class="form-control ds-input" />
                    <select name="category">
                        <option value=0>Choose a category</option>
                        @{ 
                            foreach (Category category in categories)
                            {
                                <option value=@category.Id>@category.Name</option> 
                            } 
                         }
                    </select>
                    <input type="number" name="minPrice" class="price-range" placeholder="Min price" />
                    -
                    <input type="number" name="maxPrice" class="price-range" placeholder="Max price" />
                    <input type="submit" id="search-button" class="btn btn-primary btn-sm" value="Search">
                </form>
            </div>
            @{ 
                if (products.Count == 0)
                {
                    <p class="no-products">No products to display!</p> 
                } 
             }
            <ul class="grid">
            @{ 
                foreach (Product product in products)
                {
                    if (product.IsDeleted) { continue; }

                    <li class="grid-tile">
                        <div class="item">
                            <img class="item-img" src="@product.ImageSrc" asp-append-version="true" alt="@product.ImageSrc" />
                            <div class="pnl-wrapper">
                                <div class="pnl-description">
                                    <span class="pnl-label">@product.Name</span>
                                    <span class="pnl-category">@product.Category.Name</span>
                                    <span class="pnl-price">@product.Price&#8362;</span>
                                </div>
                                @using (Html.BeginForm("AddToCart", "Cart", FormMethod.Post))
                                {
                                    <input type="hidden" name="Id" value="@product.Id" id="id" />
                                    <select class="light-border mr-2 mt-3" name="size">
                                        <option value="@Size.Small" selected>@Size.Small</option>
                                        <option value="@Size.Medium">@Size.Medium</option>
                                        <option value="@Size.Large">@Size.Large</option>
                                    </select>
                                    <div class="recommendation-form mt-3">
                                        <input id="qantity" class="light-border" type="number" name="quantity" value=1 min="1" max="100">
                                        <button type="submit" class="btn-dark icon-button add-to-cart-btn"><i class="pnl-icon fa fa-plus-circle"></i></button>
                                    </div>
                                }
                                <div class="mt-3">
                                    @foreach (Tag tag in product.Tags)
                                    {
                                        <span class="product-tag mr-2"># @tag.Name</span>
                                    }
                                </div>
                            </div>
                            
                        </div>
                    </li> 
                } 
            }
            </ul>
        </section>
    </div>
</div>

<script>
    $('.price-range').keyup(function () {
        var maxValue = $('input[name^="maxPrice"]').val();
        var minValue = $('input[name^="minPrice"]').val();

        if (!maxValue || maxValue - minValue >= 0) {
            $("#search-button").attr("disabled", false);
        } else {
            $("#search-button").attr("disabled", true);
        }

        if (!maxValue || maxValue.startsWith("-")) {
            $('input[name^="maxPrice"]').val("");
        }

        if (!minValue || minValue.startsWith("-")) {
            $('input[name^="minPrice"]').val("");
        }
    });
</script>